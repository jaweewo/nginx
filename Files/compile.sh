#!/bin/bash
echo " PLEASE READ THE END OF THE SCRIPT, IT IS IMPORTANT"
cat << EOF
*,************,(&&&&&&&&@&&&&%,,,,,,,,,*,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
***,,***,,,,,**&&&@&&&&&&&&&&&&,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,*
**,,,,*,,**,,*%&&&@&&&&&&&&&&&&@,,,*,,*,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
,**,,,,,,,,,,,&&&&&&&&&&&&&&&&&&&,,,,,,,,,*,,,,,,,,,,,,,*,,,,,,.,.,,,,,,,,,,,*%%
,,,,,,,,,,,,,*&&&&&&&@&&@@&@&@@&&&,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,.,,,,*&&&&&&
,,,,,,,,,,,,,,%&&&@&&&@&@@@@&@@&&&&%%%%%%%%%%((*,,,,,,,,,,,,,,,.,,,,*(%&&&&&&&&&
,,,,,,,,,,,,,,&&&@@&@&@&&@@@@@@&@@&&&&&&&&&&&&&&%%%%(///*****(%&%&&&&&&&&&&&&&&/
,,,,,,,,,,,,,*&&&&&@@&@@@@@@@@@@@@@@&&&&&&&&&&&&&&&&&&&%&&&&&&&&&&&&&&&&&%%&%/,,
,,,,,,,,,,,,,*&&&&@@@@@@@@@@@@@@@@@@@@@@@&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&%&%&/,,,,
,,,,,,,,,,,,,,#&&&@@@@@@&&@@@@@@@@@@@@@@&&&&&&@@@&@&&&&&@&&&&@&&&&&&&&&&&%*,,,,,
,,,,,,,,,,,,,,#&@@&&@@@@&@@@@@@&@@@@@@@@@@@@@@@@@&@&&&&&&&&@@&&&&&&&&&&&*,,,...,
,,,,,,,,,,,,(&&&&@&&@&@@@@@@@@@@@@@@@@@@@@@@@@@@@&@@&@@@@@@&@@&&&&&&&&&*....,...
,,,,,,,,,,*#&&&&&&@@@@@@@@@@@@@@&@&@@@@@@@@@@@@@@@@@@@@@@@@@@@&&&&&&&%/.,,,,,,..
,,,,,,,,,*#%&&&&&@@@&&@@&&&&&&&&@&@@@@@@@@@@@@@@@@@@@@@@@@@@&@&&&&&&&,,.,.,,..,.
,,,,,,,,,(%&&&&&&&&&&&&&@&&&&@&&&&@@@@@@@@@@@@@@@@@@@@@@&@&@&&@&&&&&%/,,.....,..
,,,,,,,,*#&&&&&&&&&@&@&@@@@@&&&&&&&&@@@@@@@@@@@@@@@@@@@@@&&&&&&&&&&&%%*..,,..,..
,,,,,,,,*#&&&&&&&&&@&@@@@@&&&&&&&&@@@@@@@@@@@@@@@@@@@@@@@&&&&&&&&&&&%%/,...,....
,,,,,,,,/%&&&&&@&&@@@@@@@@@@&&&&&&@@@@@@@@@@@@@@@@@@@@@@@@&&&&%&&&&%%%(,,..,....
,,,,,,,*/&&&&&&&&&&&&@@@@@&@&%&@@@@@@@@@@@@@@@@@@@@@@@&@@&&&&&&&%%&&%%/,.....,,.
,,,,,,,*(&&&&&&&&@&&&@@@&&&%%%&@@@@&&@@@@@@@@@@@@@@@@@&@@&&&%%&&%%%&%#,.........
,,,,,,,*/%&&&&&&&&&&@@@@@@@&&&/(%%&&@@@@@@@@@@@@@@@@@@&%&&&@&#&&&&%%%*...,......
,,,,,,,*#&&&&&&&@@@@@&&@@@@@@@&&&&&&%@&@@@@@@@@@@@@@&@#/#%&#(#%&&%%%/,,,........
,,,,,,,/%&&&&@@@@@@@@@&@@@@@@@@@@@&@&&&@@@@@@@@@@@@@%&&%%%%%&&&&%%#/,...........
,,,,,,,#&&&&&@@@@@@@@@@@@@@@@@@@@&&&&&@@@@@@&&&@@@@&&&&&&&&&&&%%%#*,............
,,,,,,/%&&&&&&@@@@@@@@@@@@@@@@@@&&&&&&@@@@@&&&&&@@@&&&&&&&&&&%%%(,.....,.....,..
,,,,,*#&&&&&@@@@@&&&&@@&&@@@@@@@&&&&&&@@@&&&&&&&&@&&&&&&&&&&&&%*,,.,.,....,.....
,,,,*(&&&&&&@@@@@@@@@@@@&@@&&&@@@@&&&&&@@&&&&&&&&@&&&&&&&&&&&%(,....,...,.......
,,,*/%&&&&&&&&&&@@@@@&@@@@@@@@@@@@&@@@&@@@&&&&&&&&&&&&&&&&&&&%(,,,,............,
**/#&&&&&&&&&&@@&&@@@@@@@@&@@@@@@@@@@@@@@@@@@@@&&&&&&&&&&&&&&%#,,,,,.......,..,.
*/%&&&&&&&&&&&@@@@@@@@@@@@@@@@@@@@@@@@@&&@@@@&@@&&&&&&&&&&&&&%#*,,,.,,.,,.....,,
(%&&&&&&&&&&&&&@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@&&&&&&%%*,,,,.,,...,,,,,,
#%&&&&&&&&&&&@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@&&&&%%%*,,.,,.,,,,.,.,,,
%&&&@@&&&&&&@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@&&&@&&&&%%%/,,,,,,,,,,,,.,,,
&&&@@@&&&&&&&@@@@@@@@@@@@@@@@@@@%@@@@@%&%&&&&&@@@@@@@@&&&&&&&%#*,,,,,,,,,,,,,,,,
&&&@@@&&@&&&&&@@@@@@@@@@@@@@@@&@@@@@@%%&&&%@@@@@@@@@@@@&&&&&&%/,,,,,,,,,,,,,,,,,
&&&@@@&&@&@&&&&@@@@@@@@@@@@@@@@@@@@&&@&&&%&&&&&&@@@@&&&&&&&&%/,,,,,,,,,,,,,,,,,,
&&@@@@&&&&&&&&@@@@@@@@@@@@@@@@@@@@@@@&@@@&&&&&@&&&&&&&&&&&&&%/*,,,,,,,,,,,,,,,,,
&&&@@@@&&@&&&@&@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@&&&&&@@&&&&&&%#*,,,,,,,,,,,,,,,,,,
&&@@@@&&&@&&&&@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@&&@@&&&&@&&&&&%%/**,,,,,,,,,,,.,,,,,
@@&@@@@@&@@&@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@&&@&@@&&@&&&&&&&%#*,,,,,,,,,,,*,,,,,,
&&&@@@@@&&&&@@@@@@@@@@@@@@@@@@@@@@@@@@&&@@@&@@@&&@&&&&&&&&&&%#/,,,,,,,,,,,,,,,,,
&@@@@@@@@@@&@@@@@@@@@@@@@@@@@@@@@@@@@@@&&@@@@@&&@@@&&&&&&&&&&%#*,,,,,,,,,,,,,,,,
@&@@@@@@&@@@@@@@@@@@@@@@@@@@@@@@@@@@@@&&&&&@@@&@&@&&&&&&&&&&&&#/,,,,,,,*,*,,,,**
&&&@@@@@@@&@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@&&&&&&&&&&&&&%/*,,,,,,,,,**,,,,
&&&&@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@&&&&&&&&&&&&&%*,,,,,*,,*,*,****
&&&&&@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@&&@@@@@@&@@@&&&&&&&&&&&#*.,**,,,,******,*
&&&&&&@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@&&&&&&&&&&&&&%#*..,*************
&@&&@&@@@@@@&@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@&&&&&&&&&&&&%(*,...************
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@&&&@&&&&&&&&&&&&&&&#*,......,**********
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@&&&&@&&&@&@&@&&&&&&&%/,........,******/**
&@@@@@@@@@@@@@@@@&@&@@@@&&&&@@@@@@@@&@&&&&&&&&&&&&&&&&&&&##/,..........,***/*/*/
&@@@@@@@@@@@@@@&@&@&&&&@&&&&&@&@@@@@@&&@@&&&&&&&&&&&&&&&%(*,,............*/**///
&&&&@@@@@@@@@@@@@@&@&&@@@@&&&&&@@@@@@@&&&&&&&&&&&&&&&&&&&#*,............../#(///
&&&&&&&@@@@@@@@@@@@@&@@@&@&&&&@@@@@@&@&&&&&&&&&&&&&&&&&&&&#,......,,,,,....*%%%%
&&&&&@&&@@@@@@@@@@@@&&@@@&&&&&&@@@@&@&&&&&&&&&&&&&&&&&&&&&&(///////*****....,%%%
#%%&&@@@@@&@@&@@@@@@@&&&&&@&&&&@@@&&&&&&@@@&&@@@@&&@@@&&&&&#/////////////,...,#%
##%%&&&@@@@@@@@@@@@@@@&&&&&&&&&@@&&&&&@@&@@&@@@@@@@@@&@@@&&&(/////////////,...,#
EOF
sleep 5
echo "Updating"
yum update 
echo "Installing the requirements for SSL"
wget --no-check-certificate https://ftp.openssl.org/source/old/1.1.1/openssl-1.1.1.tar.gz
yum install -y make gcc perl pcre-devel zlib-devel 
tar xvf openssl-1.1.1.tar.gz
echo "Changing to openssl folder"
cd openssl-1.1.1
./config --prefix=/usr --openssldir=/etc/ssl --libdir=lib no-shared zlib-dynamic
echo "Compiling"
make && make install
echo "Exporting libraries"
export LD_LIBRARY_PATH=/usr/local/lib:/usr/local/lib64
echo "export LD_LIBRARY_PATH=/usr/local/lib:/usr/local/lib64" >> ~/.bashrc
echo "Checking OpenSSL version"
openssl version

echo "Install dependent tools for Nginx"
yum install -y git wget epel-release gcc-c++ flex bison yajl yajl-devel curl-devel curl GeoIP-devel doxygen zlib-devel pcre-devel lmdb-devel libxml2-devel ssdeep-devel lua-devel libtool autoconf automake
echo "Installing nginx with ModSecurity and SSL"
cd /usr/local
git clone https://github.com/SpiderLabs/ModSecurity-nginx
wget http://nginx.org/download/nginx-1.22.1.tar.gz
tar -xvzf nginx-1.22.1.tar.gz
git clone https://github.com/gabihodoroaga/nginx-ntlm-module.git
cd /usr/local/nginx-1.22.1
./configure --http-log-path=/var/log/nginx/access.log --error-log-path=/var/log/nginx/error.log --with-http_ssl_module --add-module=../nginx-ntlm-module \
--http-client-body-temp-path=/var/cache/nginx/client_temp \
        --http-proxy-temp-path=/var/cache/nginx/proxy_temp \
        --http-fastcgi-temp-path=/var/cache/nginx/fastcgi_temp \
        --http-uwsgi-temp-path=/var/cache/nginx/uwsgi_temp \
        --http-scgi-temp-path=/var/cache/nginx/scgi_temp 
make && make install && mkdir -p /var/cache/nginx
echo "Starting nginx"
/usr/local/nginx/sbin/nginx

/usr/local/nginx/sbin/nginx -s reload